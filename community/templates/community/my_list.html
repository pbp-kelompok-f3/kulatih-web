{% extends "base.html" %}
{% load static %}
{% block title %}My Community{% endblock %}
{% block content %}

<section class="min-h-screen bg-[var(--indigo)] text-[var(--white)] px-8 md:px-20 py-12 font-bevietnam">

  <!-- Header -->
  <div class="bg-[var(--yellow)] text-[var(--indigo-dark)] py-6 px-8 rounded-2xl text-center shadow-md mb-12">
    <h1 class="text-5xl font-bebas tracking-wide">MY COMMUNITY</h1>
  </div>

  <!-- Daftar Komunitas -->
  <div class="flex flex-col gap-6">
    {% for m in memberships %}
      <div class="flex items-center bg-[var(--indigo-light)] rounded-2xl shadow-md px-6 py-5 gap-6 hover:scale-[1.01] transition-transform">

        <!-- Foto Profil -->
        <div class="w-20 h-20 rounded-full bg-[var(--indigo)] flex items-center justify-center overflow-hidden">
          {% if m.community.profile_image_url %}
            <img src="{{ m.community.profile_image_url }}" alt="{{ m.community.name }}" class="w-full h-full object-cover">
          {% else %}
            <span class="text-[var(--yellow)] font-bebas text-3xl">C</span>
          {% endif %}
        </div>

        <!-- Info Komunitas -->
      <div class="flex-1">
        <h2 class="text-xl font-bebas tracking-wide">{{ m.community.name|upper }}</h2>
        <p class="text-sm text-[var(--white)] opacity-80 leading-relaxed">
          {{ m.community.short_description }}
        </p>

        <!-- Tombol View Detail di bawah deskripsi -->
        <div class="mt-3">
          <a href="{% url 'community:detail' m.community.id %}" 
            class="text-[var(--yellow)] font-bebas text-lg hover:underline transition-colors">
            VIEW DETAIL
          </a>
        </div>
      </div>

      <!-- Tombol Go to Group & Leave -->
      <div class="flex flex-col items-end gap-2">
        <a href="{% url 'community:my_group' m.community.id %}" 
          class="bg-[var(--yellow)] text-[var(--indigo-dark)] font-bebas text-lg px-6 py-2 rounded-xl shadow hover:scale-105 transition">
          GO TO GROUP
        </a>
        <a href="{% url 'community:leave' m.community.id %}" 
          class="text-[var(--white)] font-bebas text-lg hover:text-[var(--yellow)] transition-colors">
          LEAVE
        </a>
      </div>



      </div>
    {% empty %}
      <p class="text-center text-gray-400 italic mt-10">You havenâ€™t joined any communities yet.</p>
    {% endfor %}
  </div>

  <!-- Tombol Kembali -->
  <div class="flex justify-center mt-12">
    <a href="{% url 'community:home' %}" 
       class="bg-[var(--yellow)] text-[var(--indigo-dark)] font-bebas text-2xl px-10 py-4 rounded-2xl shadow-md hover:scale-105 transition-transform">
      BACK TO COMMUNITY
    </a>
  </div>

</section>

<!-- Toast Notification -->
{% if messages %}
<div id="toast-container" class="fixed top-5 right-5 space-y-2 z-50">
  {% for message in messages %}
  <div
    class="px-4 py-3 rounded-lg shadow-lg text-white font-medium
      {% if message.tags == 'success' %}bg-green-600{% elif message.tags == 'error' %}bg-red-600{% endif %}">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

{% load static %}
<script src="{% static 'admin/js/makecomm.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // cek apakah URL mengandung '?created=true'
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get("created") === "true") {
    const toast = document.createElement("div");
    toast.textContent = "Community successfully created!";
    toast.className = "fixed top-5 right-5 bg-green-600 text-white px-4 py-2 rounded-lg shadow-md z-50";
    document.body.appendChild(toast);

    // hilangkan setelah 3 detik
    setTimeout(() => toast.remove(), 3000);

    // hapus query param dari URL agar tidak muncul lagi kalau refresh
    const cleanUrl = window.location.origin + window.location.pathname;
    window.history.replaceState({}, document.title, cleanUrl);
  }
});
</script>


{% endblock %}
