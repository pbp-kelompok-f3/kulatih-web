{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="bg-[#0f0e2e] min-h-screen text-white px-6 py-10">

    <h1 class="font-family text-center text-4xl font-extrabold mb-10 tracking-wide">FIND YOUR TOURNAMENT</h1>

    <div class="flex justify-center gap-4 mb-8">
        <button id="btn-my" class="px-6 py-2 rounded-xl bg-yellow-500 text-black font-semibold hover:scale-105 transition-all">
            My Tournament
        </button>
        <button id="btn-all" class="px-6 py-2 rounded-xl bg-gray-700 font-semibold hover:scale-105 transition-all">
            All Tournament
        </button>
        
        <a href="{% url 'tournaments:create_tournament' %}"
        class="px-6 py-2 rounded-xl bg-green-600 text-white font-semibold hover:scale-105 transition-all inline-block text-center">
        + Create Tournament
        </a>

    </div>

    <div class="flex justify-center items-center gap-3 mb-10">
        <input
            type="text"
            id="search-bar"
            placeholder="Search Tournament or Location"
            class="w-1/2 px-5 py-3 rounded-xl bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-400"
        />
        <button id="filter-btn" class="bg-yellow-500 p-3 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-black" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 4a1 1 0 0 1 1-1h16a1 1 0 0 1 .8 1.6l-6.6 8.8V19l-4 2v-7.6L3.2 5.6A1 1 0 0 1 3 4Z" />
            </svg>
        </button>
    </div>

    <div id="tournament-container" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8 justify-center"></div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("tournament-container");
    const btnAll = document.getElementById("btn-all");
    const btnMy = document.getElementById("btn-my");

    function renderEmptyState(title, message) {
        container.innerHTML = `
            <div class="flex flex-col items-center justify-center text-center col-span-full py-20 animate-fadeIn">
                <img src="{% static 'images/empty.png' %}" alt="Empty" 
                    class="w-64 h-64 object-contain mb-6 opacity-80">
                <h2 class="text-2xl font-semibold text-gray-300">${title}</h2>
                <p class="text-gray-500 mt-2">${message}</p>
            </div>
        `;
    }

    function loadTournaments(filter = "") {
        fetch("{% url 'tournaments:tournament_view' %}", {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.json())
        .then(data => {
            let tournaments = data.tournaments || [];

            if (filter) {
                tournaments = tournaments.filter(t =>
                    t.nama.toLowerCase().includes(filter.toLowerCase()) ||
                    t.lokasi.toLowerCase().includes(filter.toLowerCase())
                );
            }

            if (tournaments.length === 0) {
                renderEmptyState("No tournaments found.", "Coba buat atau cari tournament baru.");
                return;
            }

            container.innerHTML = tournaments.map(t => `
                <div onclick="window.location.href='/tournament/${t.id}/'"
                    class="bg-[#1c1b42] rounded-2xl p-5 shadow-lg hover:scale-105 transition-transform cursor-pointer animate-fadeIn">
                    <img src="${t.poster}" alt="${t.nama}" class="rounded-xl w-full h-48 object-cover mb-4">
                    <h3 class="text-lg font-semibold mb-1">${t.nama}</h3>
                    <p class="text-sm text-gray-400 mb-1">${t.tipe} • ${t.lokasi}</p>
                    <p class="text-sm text-yellow-400">${t.tanggal}</p>
                    <p class="text-xs mt-2 text-gray-400">By ${t.pembuat}</p>
                </div>
            `).join("");
        })
        .catch(err => {
            console.error(err);
            renderEmptyState("Gagal memuat tournament", "Silakan refresh halaman atau coba lagi nanti.");
        });
    }

    function loadMyTournaments() {
        fetch("{% url 'tournaments:tournament_view' %}", {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.json())
        .then(data => {
            const myName = "{{ request.user.username }}";
            const myTournaments = data.tournaments.filter(t => t.pembuat === myName);

            if (myTournaments.length === 0) {
                renderEmptyState(
                    "Anda belum membuat tournament anda.",
                    "Klik tombol “Create Tournament” untuk membuatnya."
                );
                return;
            }

            container.innerHTML = myTournaments.map(t => `
                <div onclick="window.location.href='/tournament/${t.id}/'"
                    class="bg-[#1c1b42] rounded-2xl p-5 shadow-lg hover:scale-105 transition-transform cursor-pointer animate-fadeIn">
                    <img src="${t.poster}" alt="${t.nama}" class="rounded-xl w-full h-48 object-cover mb-4">
                    <h3 class="text-lg font-semibold mb-1">${t.nama}</h3>
                    <p class="text-sm text-gray-400 mb-1">${t.tipe} • ${t.lokasi}</p>
                    <p class="text-sm text-yellow-400">${t.tanggal}</p>
                    <p class="text-xs mt-2 text-gray-400">By ${t.pembuat}</p>
                </div>
            `).join("");
        });
    }
    btnMy.addEventListener("click", loadMyTournaments);
    btnAll.addEventListener("click", loadTournaments);
    loadMyTournaments();
});

</script>
{% endblock %}
