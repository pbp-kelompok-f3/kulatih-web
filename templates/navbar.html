<nav class="flex items-center justify-between w-full h-[5rem] px-20 py-3 bg-[#0b0b23] border-b border-gray-800 font-bebas">
    <div class="flex items-center">
        <h1 class="text-4xl">
            <a href="{% url 'main:show_main' %}" class="text-white">KU</a><a href="{% url 'main:show_main' %}" class="text-yellow-400">LATIH</a>
        </h1>
    </div>

    <div class="absolute left-1/2 transform -translate-x-1/2">
        <div class="flex items-center gap-x-8 text-white tracking-wide text-2xl z-10">
            <a href="" class="hover:text-yellow-400">COACH</a>
            <a href="" class="hover:text-yellow-400">FORUM</a>
            <a href="" class="hover:text-yellow-400">COMMUNITY</a>
            <a href="" class="hover:text-yellow-400">TOURNAMENTS</a>
        </div>
    </div>

    <div class="flex items-center space-x-3">
        {% if user.is_authenticated %}
            <div class="relative">
                <button id="profile-button" class="block w-12 h-12 rounded-full overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2 focus:ring-offset-gray-800">
                    {% if user.profile.image.url %}
                        <img src="{{ user.profile.image.url }}" alt="Profile" class="w-full h-full object-cover">
                    {% else %}
                        <div class="w-full h-full text-xl rounded-full bg-gray-500 flex items-center justify-center text-white font-bebas">
                            {{ user.username|first|upper }}
                        </div>
                    {% endif %}
                </button>

                <div id="profile-menu" class="absolute right-0 z-10 mt-2 w-48 bg-[var(--indigo-light)] rounded-md shadow-lg py-1 hidden font-bevietnam">
                    <div class="px-4 py-2 text-sm text-[var(--white)] border-b">
                        <strong class="block truncate">{{ user.first_name }} {{ user.last_name }}</strong> @{{ user.username }}
                    </div>
                    
                    <a href="#" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">
                        My Profile
                    </a>
                    <a href="#" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">
                        Edit Profile
                    </a>
                    <a href="#" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)] border-b">
                        My Bookings
                    </a>
                    
                    <form method="post" action="{% url 'users:logout' %}" class="w-full">
                        {% csrf_token %}
                        <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">
                            Log out
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <a href="{% url 'users:login' %}" class="px-4 py-1.5 border border-white rounded-lg text-white hover:bg-white hover:border-white hover:text-black transition font-bevietnam">
                Log In
            </a>
            <a href="{% url 'users:register_member' %}" class="px-4 py-1.5 bg-white text-black rounded-lg hover:bg-yellow-400 hover:text-black transition font-bevietnam">
                Sign Up
            </a>
        {% endif %}
    </div>

    <div id="mobile-menu" class="hidden md:hidden border-t border-gray-700 bg-[#0b0b23]">
    {% if user.is_authenticated %}
      <div class="px-4 py-3 border-b border-gray-700">
        {% if user.profile.image.url %}
          <div class="flex items-center space-x-3">
            <img src="{{ user.profile.image.url }}" class="w-10 h-10 rounded-full object-cover">
            <div><p class="font-semibold">{{ user.username }}</p></div>
          </div>
        {% else %}
          <p class="font-semibold mb-2">Profile</p>
        {% endif %}
      </div>
      <div class="px-4 py-2 border-b border-gray-700"></div>
    {% else %}
      <div class="px-4 py-3 flex flex-col space-y-2 border-b border-gray-700">
        <a href="{{ url_login|default:'#' }}" class="hover:text-yellow-400">Log In</a>
        <a href="{{ url_signup|default:'#' }}" class="hover:text-yellow-400">Register</a>
      </div>
      <div class="px-4 py-2 border-b border-gray-700"></div>
    {% endif %}
  </div>
</nav>

<script>
  // WEB

  // Get the button and menu elements
  const profileButton = document.getElementById('profile-button');
  const profileMenu = document.getElementById('profile-menu');

  // Only run this script if the elements exist (i.e., user is logged in)
  if (profileButton && profileMenu) {
    
    // Toggle the 'hidden' class when the button is clicked
    profileButton.addEventListener('click', (event) => {
      // Stop the click from bubbling up to the document
      event.stopPropagation();
      profileMenu.classList.toggle('hidden');

      // --- ADD THIS 'if' BLOCK ---
      // If we just hid the menu, remove focus from the button
      if (profileMenu.classList.contains('hidden')) {
        profileButton.blur();
      }
      // --- END OF ADDED BLOCK ---
    });

    // Hide the menu if the user clicks anywhere else on the page
    document.addEventListener('click', (event) => {
      // Check if the menu is open AND the click was *not* on the button or inside the menu
      if (
        !profileMenu.classList.contains('hidden') &&
        !profileMenu.contains(event.target) &&
        !profileButton.contains(event.target)
      ) {
        profileMenu.classList.add('hidden');
        profileButton.blur(); // <-- ADD THIS LINE
      }
    });
  }

  // MOBILE

  // Tambah shadow saat halaman discroll
  (function(){
    const nav = document.getElementById('site-nav');
    if (!nav) return;
    const onScroll = () => {
      if (window.scrollY > 4) {
        nav.classList.add('shadow-lg');
      } else {
        nav.classList.remove('shadow-lg');
      }
    };
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });
  })();

  // WEB profile dropdown
  const profileButton = document.getElementById('profile-button');
  const profileMenu = document.getElementById('profile-menu');
  if (profileButton && profileMenu) {
    profileButton.addEventListener('click', (e) => {
      e.stopPropagation();
      profileMenu.classList.toggle('hidden');
      if (profileMenu.classList.contains('hidden')) profileButton.blur();
    });
    document.addEventListener('click', (e) => {
      if (!profileMenu.classList.contains('hidden') &&
          !profileMenu.contains(e.target) &&
          !profileButton.contains(e.target)) {
        profileMenu.classList.add('hidden');
        profileButton.blur();
      }
    });
  }

  // MOBILE burger
  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  // (Note: I don't see an element with id="menu-btn" in your HTML,
  // this might cause an error. You should add `if (menuBtn)` to be safe)
  if (menuBtn) {
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  }
</script>