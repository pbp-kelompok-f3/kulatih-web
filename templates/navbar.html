<nav class="flex items-center justify-between w-full h-[5rem] px-4 sm:px-10 lg:px-20 bg-[#0b0b23] border-b border-gray-800 font-bebas relative">
    <div class="flex items-center">
        <h1 class="text-4xl">
            <a href="{% url 'main:show_main' %}" class="text-white">KU</a><a href="{% url 'main:show_main' %}" class="text-yellow-400">LATIH</a>
        </h1>
    </div>
    <div class="hidden md:flex absolute left-1/2 transform -translate-x-1/2">
        <div class="flex items-center gap-x-8 text-white tracking-wide text-2xl z-10">
            <a href="{% url 'users:coach_list' %}" class="hover:text-yellow-400">COACH</a>
            <a href="#" class="hover:text-yellow-400">FORUM</a>
            <a href="#" class="hover:text-yellow-400">COMMUNITY</a>
            <a href="{% url 'tournaments:tournament_view' %}" class="hover:text-yellow-400">TOURNAMENTS</a>
        </div>
    </div>
    <div class="flex items-center space-x-3">
        {% if user.is_authenticated %}
            <div class="relative">
                <button id="profile-button" class="hidden md:block w-12 h-12 rounded-full overflow-hidden focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2 focus:ring-offset-gray-800">
                    {% if user.member.profile_photo %}
                      <img src="{{ user.member.profile_photo }}" alt="Profile" class="w-full h-full object-cover">
                    {% elif user.coach.profile_photo %}
                      <img src="{{ user.coach.profile_photo }}" alt="Profile" class="w-full h-full object-cover">
                    {% else %}
                      <div class="w-full h-full text-xl rounded-full bg-gray-500 flex items-center justify-center text-white font-bebas">
                          {{ user.username|first|upper }}
                      </div>
                    {% endif %}
                </button>
                <div id="profile-menu" class="absolute right-0 z-10 mt-2 w-48 bg-[var(--indigo-light)] rounded-md shadow-lg py-1 hidden font-bevietnam">
                    <div class="px-4 py-2 text-sm text-[var(--white)] border-b">
                        <strong id="profile-fullname" class="block truncate">{{ user.first_name }} {{ user.last_name }}</strong> @{{ user.username }}
                    </div>
                    <a href="{% url 'users:show_profile' %}" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">My Profile</a>
                    <a href="#" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">Edit Profile</a>
                    <a href="#" class="block px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)] border-b">My Bookings</a>
                    <form method="post" action="{% url 'users:logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-[var(--white)] hover:bg-[var(--indigo)]">Log out</button>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="hidden sm:flex space-x-3">
                <a href="{% url 'users:login' %}" class="px-4 py-1.5 border border-white rounded-lg text-white hover:bg-white hover:text-black transition font-bevietnam">Log In</a>
                <a href="{% url 'users:register_member' %}" class="px-4 py-1.5 bg-white text-black rounded-lg hover:bg-yellow-400 hover:text-black transition font-bevietnam">Sign Up</a>
            </div>
        {% endif %}
        <button id="menu-btn" class="md:hidden text-white focus:outline-none">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>
    </div>
    <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-[#0b0b23] border-t border-gray-700">
        <div class="flex flex-col p-4 space-y-2">
            <a href="#" class="hover:text-yellow-400">COACH</a>
            <a href="#" class="hover:text-yellow-400">FORUM</a>
            <a href="{% url 'users:coach_list'}" class="hover:text-yellow-400">COMMUNITY</a>
            <a href="{% url 'tournaments:tournament_view' %}" class="hover:text-yellow-400">TOURNAMENTS</a>
            {% if user.is_authenticated %}
                <a href="#" class="hover:text-yellow-400">My Profile</a>
                <a href="{% url 'users:show_profile' %}?action=edit" class="hover:text-yellow-400">Edit Profile</a>
                <form method="post" action="{% url 'users:logout' %}">
                    {% csrf_token %}
                    <button type="submit" class="w-full text-left hover:text-yellow-400">Log Out</button>
                </form>
            {% else %}
                <a href="{% url 'users:login' %}" class="hover:text-yellow-400">Log In</a>
                <a href="{% url 'users:register_member' %}" class="hover:text-yellow-400">Sign Up</a>
            {% endif %}
        </div>
    </div>
</nav>

<script>
const profileButton = document.getElementById('profile-button');
const profileMenu = document.getElementById('profile-menu');
if (profileButton && profileMenu) {
    profileButton.addEventListener('click', (e) => {
        e.stopPropagation();
        profileMenu.classList.toggle('hidden');
        if (profileMenu.classList.contains('hidden')) profileButton.blur();
    });
    document.addEventListener('click', (e) => {
        if (!profileMenu.classList.contains('hidden') &&
            !profileMenu.contains(e.target) &&
            !profileButton.contains(e.target)
        ) {
            profileMenu.classList.add('hidden');
            profileButton.blur();
        }
    });
}

const menuBtn = document.getElementById('menu-btn');
const mobileMenu = document.getElementById('mobile-menu');
if (menuBtn) {
    menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });
}
</script>
