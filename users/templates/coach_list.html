{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="bg-[var(--indigo)] min-h-screen text-[var(--white)] font-bevietnam">

    <!-- Hero Section with Search -->
    <div class="relative pt-20 pb-16 px-4 sm:px-6 lg:px-8">
        <!-- Background Image with Gradient Overlay -->
        <div class="absolute inset-0 z-0 overflow-hidden">
            <img 
                src="{% static 'image/bg-coach_list.jpg' %}" 
                alt="Background" 
                class="w-full h-full object-cover"
            >
            <!-- Gradient overlay for readability -->
            <div class="absolute inset-0 bg-[#0c0b1c]/70"></div>
        </div>

        <div class="max-w-4xl mx-auto text-center space-y-8 relative z-10">
            <!-- Title -->
            <h1 class="font-bebas text-6xl md:text-7xl">
                TRAIN WITH <span class="text-[var(--yellow)]">EXPERIENCED COACHES</span>
            </h1>

<<<<<<< HEAD
      <svg xmlns="http://www.w3.org/2000/svg"
        class="hidden md:block w-5 h-5 absolute left-[calc(50%-33%)] top-1/2 -translate-y-1/2 text-gray-400"
        fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>

    <!-- Coach Grid -->
    <div id="coachGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
      {% if coaches %}
        {% for coach in coaches %}
          <a href="{% url 'users:coach_detail' coach.id %}" 
             class="bg-[var(--indigo)] p-4 rounded-2xl shadow-lg hover:shadow-2xl hover:-translate-y-1.5 transition-all duration-300 flex flex-col group">
            
            <!-- Foto -->
            <div class="rounded-xl overflow-hidden w-full aspect-square mb-4">
            {% if coach.profile_photo %}
                <img src="{{ coach.profile_photo.url }}" 
                    alt="{{ coach.user.username }}" 
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
            {% else %}
                <img src="https://icon-library.com/images/default-profile-icon/default-profile-icon-24.jpg" 
                    alt="{{ coach.user.username }}" 
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
            {% endif %}

=======
            <!-- Search Bar -->
            <div class="relative max-w-2xl mx-auto">
                <form method="GET" action="{% url 'users:coach_list' %}" class="relative">
                    <input 
                        type="text" 
                        name="q" 
                        value="{{ search_query|default:'' }}" 
                        placeholder="Search Coach..."
                        class="w-full pl-6 pr-32 py-4 rounded-full bg-[var(--indigo-dark)] border-2 border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-[var(--yellow)] transition-all text-lg"
                    >
                    <button 
                        type="submit" 
                        class="absolute right-2 top-1/2 -translate-y-1/2 px-8 py-2.5 bg-[var(--yellow)] text-[var(--indigo-dark)] rounded-full font-bold hover:bg-yellow-400 transition-colors"
                    >
                        Search
                    </button>
                </form>
>>>>>>> 776b9958eade7eeb1746b31051e52493053dc614
            </div>

            <!-- Sport Filter Pills -->
            <div class="flex flex-wrap items-center justify-center gap-3 pt-4">
                <a href="{% url 'users:coach_list' %}" 
                   class="px-6 py-2.5 rounded-full text-sm font-semibold transition-all {% if not sport_filter %}bg-[var(--yellow)] text-[var(--indigo-dark)]{% else %}bg-[var(--indigo-dark)] text-gray-300 hover:bg-[var(--indigo-light)] border-2 border-white/10{% endif %}">
                    All Sports
                </a>
                {% for sport_choice in sport_choices|slice:":5" %}
                <a href="?sport={{ sport_choice.0 }}{% if search_query %}&q={{ search_query }}{% endif %}" 
                   class="px-6 py-2.5 rounded-full text-sm font-semibold transition-all {% if sport_filter == sport_choice.0 %}bg-[var(--yellow)] text-[var(--indigo-dark)]{% else %}bg-[var(--indigo-dark)] text-gray-300 hover:bg-[var(--indigo-light)] border-2 border-white/10{% endif %}">
                    {{ sport_choice.1 }}
                </a>
                {% endfor %}
                {% if sport_choices|length > 5 %}
                <div class="relative z-[60]" id="more-sports-dropdown">
                    <button type="button" id="more-sports-btn" class="px-6 py-2.5 rounded-full text-sm font-semibold bg-[var(--indigo-dark)] text-gray-300 hover:bg-[var(--indigo-light)] border-2 border-white/10 transition-all">
                        More ▼
                    </button>
                    <div id="more-sports-menu" class="hidden absolute top-full mt-2 right-0 bg-[var(--indigo-dark)] border-2 border-white/10 rounded-xl shadow-xl py-2 min-w-[200px] max-h-[300px] overflow-y-auto">
                        {% for sport_choice in sport_choices|slice:"5:" %}
                        <a href="?sport={{ sport_choice.0 }}{% if search_query %}&q={{ search_query }}{% endif %}" 
                           class="block px-4 py-2 text-sm hover:bg-[var(--indigo-light)] transition-colors {% if sport_filter == sport_choice.0 %}text-[var(--yellow)] font-semibold{% else %}text-gray-300{% endif %}">
                            {{ sport_choice.1 }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="absolute inset-x-0 bottom-0 h-12 bg-gradient-to-b from-transparent to-[var(--indigo)]"></div>
    </div>

    <!-- Show All Button -->
    {% if search_query or sport_filter %}
    <div class="flex justify-end max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <a href="{% url 'users:coach_list' %}" 
            class="flex items-center gap-2 px-4 py-2 text-sm text-gray-400 hover:text-[var(--yellow)] transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Clear filters
        </a>
    </div>
    {% endif %}

    <!-- Coach Cards Grid -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16 mt-8">

        {% if coaches %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for coach in coaches %}
            <a href="{% url 'users:coach_detail' coach.id %}" class="group">
                <article class="relative bg-[var(--indigo-dark)] rounded-3xl overflow-hidden border-2 border-white/5 hover:border-[var(--yellow)]/50 transition-all duration-300 hover:shadow-2xl hover:shadow-[var(--yellow)]/20">
                    
                    <!-- Coach Photo -->
                    <div class="relative aspect-square overflow-hidden">
                        {% if coach.profile_photo %}
                        <img 
                            src="{{ coach.profile_photo }}" 
                            alt="{{ coach.user.get_full_name }}" 
                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                        >
                        {% else %}
                        <div class="w-full h-full bg-[var(--indigo-light)] flex items-center justify-center">
                            <svg class="w-32 h-32 text-gray-700" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        {% endif %}
                        
                        <!-- Gradient Overlay -->
                        <div class="absolute inset-0 bg-gradient-to-t from-[var(--indigo-dark)] via-transparent to-transparent opacity-80"></div>
                    </div>

                    <!-- Coach Info -->
                    <div class="p-5 space-y-2">
                        <h2 class="font-bebas text-2xl tracking-wide group-hover:text-[var(--yellow)] transition-colors">
                            {{ coach.user.get_full_name }}
                        </h2>
                        
                        <p class="text-sm text-gray-400">
                            {{ coach.get_sport_display }} · {{ coach.city }}
                        </p>

                        <p class="text-lg font-bold text-white pt-2">
                            IDR {{ coach.hourly_fee|floatformat:0 }}<span class="text-sm font-normal text-gray-400">/hour</span>
                        </p>
                    </div>
                </article>
            </a>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="flex justify-center items-center gap-3 mt-12">
            <!-- Previous Button -->
            <button 
                type="button"
                data-page="{% if page_obj.has_previous %}{{ page_obj.previous_page_number }}{% else %}1{% endif %}"
                class="pagination-btn w-14 h-14 rounded-xl border-2 text-white transition-all duration-300 {% if page_obj.has_previous %}border-white/20 hover:border-[var(--yellow)] hover:bg-[var(--yellow)]/10{% else %}border-white/10 opacity-30 cursor-not-allowed{% endif %}"
                {% if not page_obj.has_previous %}disabled{% endif %}>
                &lt;
            </button>

            <!-- Page Numbers -->
            {% with page_obj.paginator.num_pages as total_pages %}
            {% with page_obj.number as current_page %}
                
                <!-- Always show page 1 -->
                <button 
                    type="button"
                    data-page="1"
                    class="pagination-btn w-14 h-14 rounded-xl border-2 font-semibold transition-all duration-300 {% if current_page == 1 %}bg-[var(--yellow)] text-[var(--indigo-dark)] border-[var(--yellow)]{% else %}border-white/20 text-white hover:border-[var(--yellow)] hover:bg-[var(--yellow)]/10{% endif %}">
                    1
                </button>

                <!-- Show ellipsis if current page is far from start -->
                {% if current_page > 3 %}
                <span class="w-14 h-14 flex items-center justify-center text-white/50">...</span>
                {% endif %}

                <!-- Show pages around current page -->
                {% for i in page_obj.paginator.page_range %}
                    {% if i > 1 and i < total_pages %}
                        {% if i >= current_page|add:"-1" and i <= current_page|add:"1" %}
                        <button 
                            type="button"
                            data-page="{{ i }}"
                            class="pagination-btn w-14 h-14 rounded-xl border-2 font-semibold transition-all duration-300 {% if current_page == i %}bg-[var(--yellow)] text-[var(--indigo-dark)] border-[var(--yellow)]{% else %}border-white/20 text-white hover:border-[var(--yellow)] hover:bg-[var(--yellow)]/10{% endif %}">
                            {{ i }}
                        </button>
                        {% endif %}
                    {% endif %}
                {% endfor %}

                <!-- Show ellipsis if current page is far from end -->
                {% if current_page < total_pages|add:"-2" %}
                <span class="w-14 h-14 flex items-center justify-center text-white/50">...</span>
                {% endif %}

                <!-- Always show last page if more than 1 page -->
                {% if total_pages > 1 %}
                <button 
                    type="button"
                    data-page="{{ total_pages }}"
                    class="pagination-btn w-14 h-14 rounded-xl border-2 font-semibold transition-all duration-300 {% if current_page == total_pages %}bg-[var(--yellow)] text-[var(--indigo-dark)] border-[var(--yellow)]{% else %}border-white/20 text-white hover:border-[var(--yellow)] hover:bg-[var(--yellow)]/10{% endif %}">
                    {{ total_pages }}
                </button>
                {% endif %}

            {% endwith %}
            {% endwith %}

            <!-- Next Button -->
            <button 
                type="button"
                data-page="{% if page_obj.has_next %}{{ page_obj.next_page_number }}{% else %}{{ page_obj.number }}{% endif %}"
                class="pagination-btn w-14 h-14 rounded-xl border-2 text-white transition-all duration-300 {% if page_obj.has_next %}border-white/20 hover:border-[var(--yellow)] hover:bg-[var(--yellow)]/10{% else %}border-white/10 opacity-30 cursor-not-allowed{% endif %}"
                {% if not page_obj.has_next %}disabled{% endif %}>
                &gt;
            </button>
        </div>

        {% else %}
        <!-- Empty State -->
        <div class="text-center py-20">
            <svg class="w-24 h-24 mx-auto text-gray-600 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <h3 class="text-2xl font-bold text-gray-400 mb-2">No coaches found</h3>
            <p class="text-gray-500 mb-6">Try adjusting your search criteria</p>
            <a href="{% url 'users:coach_list' %}" class="inline-block px-8 py-3 bg-[var(--yellow)] text-[var(--indigo-dark)] rounded-full font-semibold hover:bg-yellow-400 transition-colors">
                View All Coaches
            </a>
        </div>
        {% endif %}
    </div>

</div>

<script>
// More sports dropdown functionality
const moreBtn = document.getElementById('more-sports-btn');
const moreMenu = document.getElementById('more-sports-menu');

if (moreBtn && moreMenu) {
    moreBtn.addEventListener('click', () => {
        moreMenu.classList.toggle('hidden');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!moreBtn.contains(e.target) && !moreMenu.contains(e.target)) {
            moreMenu.classList.add('hidden');
        }
    });
}

// Pagination function using event delegation
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('pagination-btn') && !e.target.disabled) {
        const pageNumber = e.target.getAttribute('data-page');
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('page', pageNumber);
        window.location.href = '?' + urlParams.toString();
    }
});
</script>
{% endblock %}